/* Test rotate left functions from stdbit.h  - unsigned long long would work, too, except for running out of code memory on pdk15.

   type: unsigned char, unsigned short, unsigned int, unsigned long
 */

#include <testfwk.h>

#pragma std_c23

#if __STDC_VERSION__ > 202311L || defined(__SDCC)
#include <stdbit.h>
#endif

volatile {type} i;

{type} rol({type} v, unsigned int c)
{
  c %= sizeof({type}) * 8;
  return(v << c) | (v >> (sizeof({type}) * 8 - c));
}

void
testRotateLeft(void)
{
#if __STDC_VERSION__ > 202311L || defined(__SDCC)
  i = 0xa5;
  ASSERT(stdc_rotate_left(i, 1) == rol(i, 1));
  ASSERT(stdc_rotate_left(i, 4) == rol(i, 4));
  ASSERT(stdc_rotate_left(i, 7) == rol(i, 7));
#ifndef __SDCC_pdk14 // Lack of memory
  ASSERT(stdc_rotate_left(i, 8) == rol(i, 8));
  ASSERT(stdc_rotate_left(i, 9) == rol(i, 9));
  ASSERT(stdc_rotate_left(i, 12) == rol(i, 12));
  ASSERT(stdc_rotate_left(i, 15) == rol(i, 15));

  ASSERT(stdc_rotate_left_uc(0xa5, 4) == 0x5a);
  ASSERT(stdc_rotate_left_us(0xa5b6, 4) == 0x5b6a);
#endif
#endif
}

